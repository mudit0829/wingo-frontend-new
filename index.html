<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WinGo Game</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- HEADER -->
<div class="header">
  <img src="assets/logo.png" alt="Game Logo" class="logo">
  <div class="header-icons">
    <img src="assets/user-icon.png" alt="User" class="icon">
    <img src="assets/settings-icon.png" alt="Settings" class="icon">
  </div>
</div>

<!-- WALLET SECTION -->
<div class="wallet-card">
  <div class="wallet-balance">
    <div class="balance-amount">\u20b9<span id="walletAmount">0.00</span></div>
    <div class="balance-label">Wallet balance</div>
  </div>
  <div class="wallet-buttons">
    <button class="btn-withdraw">Withdraw</button>
    <button class="btn-deposit">Deposit</button>
  </div>
</div>

<!-- FOOTER MESSAGE -->
<div class="footer-message">
  <span class="speaker-icon">\ud83d\udd0a</span>
  Please Fill In The Correct Bank Card Inform
  <button class="detail-btn">Detail</button>
</div>

<!-- ROUND TABS -->
<div class="round-tabs">
  <div class="tab active"><img src="assets/clock-active.png" alt="WinGo 30s"><span>WinGo 30sec</span></div>
  <div class="tab"><img src="assets/clock-inactive.png" alt="WinGo 1min"><span>WinGo 1 Min</span></div>
  <div class="tab"><img src="assets/clock-inactive.png" alt="WinGo 3min"><span>WinGo 3 Min</span></div>
  <div class="tab"><img src="assets/clock-inactive.png" alt="WinGo 5min"><span>WinGo 5 Min</span></div>
</div>

<!-- TIMER SECTION -->
<div class="timer-section">
  <div class="how-to-play">
    <button class="how-to-play-btn">How to play</button>
    <div class="game-type">WinGo 30sec</div>
  </div>
  <div class="timer-info">
    <div class="timer-balls">
      <img src="assets/ball-2.png" alt="2">
      <img src="assets/ball-3.png" alt="3">
      <img src="assets/ball-5.png" alt="5">
      <img src="assets/ball-9.png" alt="9">
      <img src="assets/ball-5.png" alt="5">
    </div>
    <div class="timer-countdown">
      <div class="time-label">Time remaining</div>
      <div class="time-digits" id="timeDigits">00:30</div>
      <div class="round-id" id="roundId">Loading...</div>
    </div>
  </div>
</div>

<!-- COLOR BETTING -->
<div class="color-betting-section">
  <button class="color-btn green" onclick="openPopup('Green')">Green</button>
  <button class="color-btn violet" onclick="openPopup('Violet')">Violet</button>
  <button class="color-btn red" onclick="openPopup('Red')">Red</button>
</div>

<!-- NUMBER BALLS GRID -->
<div class="number-balls-grid">
  <!-- Numbers 0-9 -->
  <img src="assets/ball-0.png" onclick="openPopup(0)">
  <img src="assets/ball-1.png" onclick="openPopup(1)">
  <img src="assets/ball-2.png" onclick="openPopup(2)">
  <img src="assets/ball-3.png" onclick="openPopup(3)">
  <img src="assets/ball-4.png" onclick="openPopup(4)">
  <img src="assets/ball-5.png" onclick="openPopup(5)">
  <img src="assets/ball-6.png" onclick="openPopup(6)">
  <img src="assets/ball-7.png" onclick="openPopup(7)">
  <img src="assets/ball-8.png" onclick="openPopup(8)">
  <img src="assets/ball-9.png" onclick="openPopup(9)">
</div>

<!-- MULTIPLIERS ROW -->
<div class="multipliers-row">
  <button class="multiplier-btn">Random</button>
  <button class="multiplier-btn active">X1</button>
  <button class="multiplier-btn">X5</button>
  <button class="multiplier-btn">X10</button>
  <button class="multiplier-btn">X20</button>
  <button class="multiplier-btn">X50</button>
  <button class="multiplier-btn">X100</button>
</div>

<!-- POPUP FOR BET PLACEMENT -->
<div class="popup" id="betPopup">
  <h3 id="popupTitle">Place Bet</h3>
  <div>
    <label>Amount: </label>
    <input type="number" id="betAmount" value="1" min="1">
  </div>
  <div style="margin-top:10px;">
    <button class="btn-primary" onclick="confirmBet()">Confirm</button>
    <button class="btn-cancel" onclick="closePopup()">Cancel</button>
  </div>
</div>

<!-- HISTORY TABS -->
<div class="history-tabs">
  <button class="tab-btn active" onclick="showTab('gameHistory')">Game history</button>
  <button class="tab-btn" onclick="showTab('chart')">Chart</button>
  <button class="tab-btn" onclick="showTab('myHistory')">My history</button>
</div>

<!-- GAME HISTORY SECTION -->
<div class="tab-content" id="gameHistory">
  <!-- History Table Here -->
</div>
<div class="tab-content hidden" id="chart">
  <!-- Chart Data Here -->
</div>
<div class="tab-content hidden" id="myHistory">
  <!-- My History Data Here -->
</div>

<script>
const apiUrl = "https://wingo-backend-nqk5.onrender.com";
let currentEmail = localStorage.getItem("userEmail") || "user@example.com";
let currentRoundId = "";
let selectedBetType = "";

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
  document.getElementById(tabId).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
}

function openPopup(betType) {
  selectedBetType = betType;
  document.getElementById("popupTitle").innerText = `Place Bet on ${betType}`;
  document.getElementById("betPopup").classList.add("show");
}

function closePopup() {
  document.getElementById("betPopup").classList.remove("show");
}

async function confirmBet() {
  const amount = parseFloat(document.getElementById("betAmount").value);
  if (amount <= 0) return alert("Enter valid amount");

  let betData = { email: currentEmail, roundId: currentRoundId, amount };

  if (typeof selectedBetType === 'number') betData.numberBet = selectedBetType;
  else betData.colorBet = selectedBetType;

  try {
    const res = await fetch(`${apiUrl}/api/bets`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(betData)
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Bet Failed!");

    alert("\u2705 Bet Placed!");
    fetchWalletBalance();
    closePopup();

  } catch (err) {
    alert(err.message);
  }
}

async function fetchWalletBalance() {
  try {
    const res = await fetch(`${apiUrl}/api/users/wallet/${currentEmail}`);
    const data = await res.json();
    document.getElementById("walletAmount").innerText = (data.wallet || 0).toFixed(2);
  } catch (err) {
    console.error("Wallet Fetch Failed:", err);
  }
}

async function fetchCurrentRound() {
  try {
    const res = await fetch(`${apiUrl}/api/rounds`);
    const rounds = await res.json();
    if (rounds.length === 0) return;

    const round = rounds[0];
    currentRoundId = round.roundId;
    document.getElementById("roundId").innerText = round.roundId;

    const startTime = new Date(round.startTime).getTime();
    const now = Date.now();
    let remaining = 30 - Math.floor((now - startTime) / 1000);

    if (remaining <= 0) remaining = 0;
    const minutes = String(Math.floor(remaining / 60)).padStart(2, '0');
    const seconds = String(remaining % 60).padStart(2, '0');
    document.getElementById("timeDigits").innerText = `${minutes}:${seconds}`;

  } catch (err) {
    console.error("Round Fetch Failed:", err);
  }
}

// INIT
fetchWalletBalance();
fetchCurrentRound();
setInterval(fetchCurrentRound, 1000);
</script>

</body>
</html>
